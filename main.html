<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MCP Coin</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }

        .header {
            margin-bottom: 20px;
        }

        .balance {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .level {
            font-size: 18px;
            margin-bottom: 20px;
        }

        .coin {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin: 30px auto;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            transition: all 0.1s ease;
            box-shadow: 0 10px 20px rgba(0,0,0,0.3);
            border: 4px solid gold;
        }

        .coin:active {
            transform: scale(0.95);
        }

        .stats {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 15px;
            margin: 20px 0;
        }

        .upgrades {
            margin-top: 20px;
        }

        .upgrade-btn {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            border: none;
            padding: 12px 20px;
            margin: 5px;
            border-radius: 25px;
            color: #333;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .upgrade-btn:disabled {
            background: #666;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>MCP Coin</h1>
            <div class="balance">Баланс: <span id="balance">0</span> ₿</div>
            <div class="level">Уровень: <span id="level">1</span>/50</div>
        </div>

        <div class="coin" id="coin">MCP</div>

        <div class="stats">
            <div>Монет за клик: <span id="coinsPerClick">1</span></div>
            <div>Следующий уровень через: <span id="nextLevelCost">100</span> ₿</div>
        </div>

        <div class="upgrades">
            <button class="upgrade-btn" onclick="upgradeClick()">
                Улучшить клик (+1) - 50 ₿
            </button>
            <button class="upgrade-btn" onclick="buyAutoClicker()">
                Автокликер (1/сек) - 200 ₿
            </button>
        </div>
    </div>

    <script>
        // Инициализация Telegram Web App
        let tg = window.Telegram.WebApp;
        tg.expand();
        tg.MainButton.setText("Сохранить прогресс").show();

        // Игровые переменные
        let gameState = {
            balance: 0,
            level: 1,
            coinsPerClick: 1,
            nextLevelCost: 100,
            autoClickers: 0,
            upgradeClickCost: 50,
            autoClickerCost: 200
        };

        // Цвета для каждого уровня (50 уровней)
        const levelColors = [
            '#FFD700', '#C0C0C0', '#CD7F32', '#FF6B6B', '#4ECDC4',
            '#45B7D1', '#96CEB4', '#FFEAA7', '#DDA0DD', '#98D8C8',
            '#F7DC6F', '#BB8FCE', '#85C1E9', '#F8C471', '#82E0AA',
            '#F1948A', '#85C1E9', '#D7BDE2', '#F9E79F', '#A9DFBF',
            '#F5B7B1', '#AED6F1', '#E8DAEF', '#FDEBD0', '#D1F2EB',
            '#FADBD8', '#D6EAF8', '#E8DAEF', '#FAE5D3', '#D0ECE7',
            '#FDEDEC', '#EBF5FB', '#F4ECF7', '#FDF2E9', '#E8F8F5',
            '#FEF9E7', '#EAF2F8', '#F5EEF8', '#FDEBD0', '#D1F2EB',
            '#FDEDEC', '#EBF5FB', '#F4ECF7', '#FDF2E9', '#E8F8F5',
            '#FEF9E7', '#EAF2F8', '#F5EEF8', '#FDEBD0', '#D1F2EB',
            '#FF0000' // Специальный цвет для максимального уровня
        ];

        // Загрузка сохраненного состояния
        function loadGame() {
            const saved = localStorage.getItem('mcpCoinGame');
            if (saved) {
                gameState = {...gameState, ...JSON.parse(saved)};
            }
            updateUI();
        }

        // Сохранение игры
        function saveGame() {
            localStorage.setItem('mcpCoinGame', JSON.stringify(gameState));
        }

        // Обновление интерфейса
        function updateUI() {
            document.getElementById('balance').textContent = gameState.balance;
            document.getElementById('level').textContent = gameState.level;
            document.getElementById('coinsPerClick').textContent = gameState.coinsPerClick;
            document.getElementById('nextLevelCost').textContent = gameState.nextLevelCost;

            // Обновление цвета монеты в зависимости от уровня
            const coin = document.getElementById('coin');
            const colorIndex = Math.min(gameState.level - 1, levelColors.length - 1);
            coin.style.background = `radial-gradient(circle at 30% 30%, ${levelColors[colorIndex]}, ${darkenColor(levelColors[colorIndex], 30)})`;
            coin.style.borderColor = levelColors[colorIndex];

            // Обновление кнопок улучшений
            document.querySelectorAll('.upgrade-btn')[0].innerHTML =
                `Улучшить клик (+1) - ${gameState.upgradeClickCost} ₿`;
            document.querySelectorAll('.upgrade-btn')[1].innerHTML =
                `Автокликер (${gameState.autoClickers}/сек) - ${gameState.autoClickerCost} ₿`;

            // Блокировка кнопок при недостатке средств
            document.querySelectorAll('.upgrade-btn')[0].disabled =
                gameState.balance < gameState.upgradeClickCost;
            document.querySelectorAll('.upgrade-btn')[1].disabled =
                gameState.balance < gameState.autoClickerCost;
        }

        // Функция затемнения цвета
        function darkenColor(color, percent) {
            const num = parseInt(color.replace('#', ''), 16);
            const amt = Math.round(2.55 * percent);
            const R = (num >> 16) - amt;
            const G = (num >> 8 & 0x00FF) - amt;
            const B = (num & 0x0000FF) - amt;
            return '#' + (
                0x1000000 +
                (R < 255 ? R < 1 ? 0 : R : 255) * 0x10000 +
                (G < 255 ? G < 1 ? 0 : G : 255) * 0x100 +
                (B < 255 ? B < 1 ? 0 : B : 255)
            ).toString(16).slice(1);
        }

        // Клик по монете
        document.getElementById('coin').addEventListener('click', function() {
            gameState.balance += gameState.coinsPerClick;
            checkLevelUp();
            updateUI();
            saveGame();

            // Анимация клика
            this.style.transform = 'scale(0.95)';
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 100);
        });

        // Проверка повышения уровня
        function checkLevelUp() {
            if (gameState.balance >= gameState.nextLevelCost && gameState.level < 50) {
                gameState.level++;
                gameState.nextLevelCost = Math.round(gameState.nextLevelCost * 1.5);

                // Уведомление о новом уровне
                if (tg && tg.showPopup) {
                    tg.showPopup({
                        title: 'Новый уровень!',
                        message: `Поздравляем! Вы достигли уровня ${gameState.level}`,
                        buttons: [{type: 'ok'}]
                    });
                }
            }
        }

        // Улучшение клика
        function upgradeClick() {
            if (gameState.balance >= gameState.upgradeClickCost) {
                gameState.balance -= gameState.upgradeClickCost;
                gameState.coinsPerClick++;
                gameState.upgradeClickCost = Math.round(gameState.upgradeClickCost * 1.2);
                updateUI();
                saveGame();
            }
        }

        // Покупка автокликера
        function buyAutoClicker() {
            if (gameState.balance >= gameState.autoClickerCost) {
                gameState.balance -= gameState.autoClickerCost;
                gameState.autoClickers++;
                gameState.autoClickerCost = Math.round(gameState.autoClickerCost * 1.5);
                updateUI();
                saveGame();
            }
        }

        // Система автокликера
        setInterval(() => {
            if (gameState.autoClickers > 0) {
                gameState.balance += gameState.autoClickers;
                checkLevelUp();
                updateUI();
                saveGame();
            }
        }, 1000);

        // Обработчик кнопки сохранения в Telegram
        tg.MainButton.onClick(function() {
            saveGame();
            tg.showPopup({
                title: 'Успех!',
                message: 'Прогресс сохранен!',
                buttons: [{type: 'ok'}]
            });
        });

        // Загрузка игры при старте
        loadGame();
    </script>
</body>
</html>